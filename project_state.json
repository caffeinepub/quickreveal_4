{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "NEXUS v8.0 — Plateforme beauté suisse production. React 18 TypeScript + Motoko ICP mainnet. Auth via Internet Identity. Paiements TWINT exclusif via Payrexx. SMS OTP via Cloudflare Worker (Twilio). Architecture multi-fichiers complète. Zéro Stripe, zéro emoji, zéro mode demo en production.",
  "architectural_notes": [
    "Stack: React 18 TypeScript strict + Motoko ICP mainnet + Internet Identity (passkeys) + Payrexx TWINT + Twilio via Cloudflare Worker",
    "Navigation: useState uniquement — routing conditionnel, zéro react-router",
    "Layout: position fixed inset 0, flex column, scroll zone flex-1 overflow-y auto, CTA flex-shrink 0, tab bar flex-shrink 0 jamais fixed",
    "Paiements: TWINT via Payrexx exclusivement — frontend fetch createGateway, window.location.href vers paymentUrl, zéro Stripe/Revolut",
    "OTP: Cloudflare Worker sécurisé (VITE_WORKER_URL) — credentials Twilio jamais exposés côté frontend",
    "Canister Motoko: stubs HTTP outcalls Payrexx documentés en commentaires, prêts à décommenter quand ExperimentalInternetComputer disponible en mainnet",
    "Design: Inter uniquement, palette CSS vars (--void, --gold, --flash, --alert, --blue), fond gold → texte #050507 absolu, zéro emoji → SVG components",
    "SetupScreen au premier démarrage si variables env vides — sauvegarde localStorage + canister admin config"
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-create-frontend-src-lib-payrexx-ts-with-the-exact-implementation-provided-createsubscriptionurl-proid-email-phone-and-createbookingurl-bookingid-montant-servicename-email-functions-that-call-the-payrexx-api-directly-from-the-frontend-using-vite-payrexx-instance-and-vite-payrexx-secret-env-vars-always-passing-psp-0-twint-returning-the-gateway-link-url-no-stripe-no-revolut-references-anywhere",
      "title": "Create `frontend/src/lib/payrexx.ts` with the exact implementation provided: `createSubscriptionUrl(proId, email, phone)` and `createBookingUrl(bookingId, montant, serviceName, email)` functions that call the Payrexx API directly from the frontend using `VITE_PAYREXX_INSTANCE` and `VITE_PAYREXX_SECRET` env vars, always passing `psp[0]=twint`, returning the gateway link URL. No Stripe, no Revolut references anywhere.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-create-frontend-src-lib-twilio-ts-with-sendotp-phone-and-verifyotp-phone-code-functions-that-proxy-through-vite-worker-url-send-otp-and-verify-otp-endpoints-credentials-are-never-exposed-on-the-frontend-verifyotp-returns-data-valid-true",
      "title": "Create `frontend/src/lib/twilio.ts` with `sendOTP(phone)` and `verifyOTP(phone, code)` functions that proxy through `VITE_WORKER_URL` (`/send-otp` and `/verify-otp` endpoints). Credentials are never exposed on the frontend. `verifyOTP` returns `data.valid === true`.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-refactor-the-entire-frontend-into-the-exact-multi-file-architecture-specified-deliver-every-file-listed-src-app-tsx-usestate-routing-toastcontainer-notifspanel-src-state-useappstate-ts-global-state-go-showtoast-update-src-lib-actor-ts-icp-internet-identity-createactor-login-logout-src-lib-api-ts-all-canister-functions-src-lib-notifications-ts-getnotifications-markread-src-styles-globals-css-css-vars-palette-keyframe-animations-mobile-reset-scrollbar-hidden-and-src-components-icons-index-tsx-30-svg-icon-components-zero-emojis",
      "title": "Refactor the entire frontend into the exact multi-file architecture specified. Deliver every file listed: `src/App.tsx` (useState routing, ToastContainer, NotifsPanel), `src/state/useAppState.ts` (global state, `go()`, `showToast()`, `update()`), `src/lib/actor.ts` (ICP Internet Identity, createActor, login, logout), `src/lib/api.ts` (all canister functions), `src/lib/notifications.ts` (getNotifications, markRead), `src/styles/globals.css` (CSS vars palette, keyframe animations, mobile reset, scrollbar hidden), and `src/components/icons/index.tsx` (30+ SVG icon components, zero emojis).",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-deliver-all-auth-screens-src-screens-auth-loginscreen-tsx-internet-identity-login-real-icp-mainnet-src-screens-auth-rolescreen-tsx-client-professional-admin-role-selection-src-screens-auth-otpscreen-tsx-6-digit-sms-otp-input-verified-via-lib-twilio-ts-cloudflare-worker-all-screens-must-have-back-navigation-and-no-emoji",
      "title": "Deliver all auth screens: `src/screens/auth/LoginScreen.tsx` (Internet Identity login, real ICP mainnet), `src/screens/auth/RoleScreen.tsx` (client / professional / admin role selection), `src/screens/auth/OTPScreen.tsx` (6-digit SMS OTP input verified via `lib/twilio.ts` Cloudflare Worker). All screens must have back navigation and no emoji.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-deliver-all-client-screens-explorerscreen-tsx-ficheproscreen-tsx-booking1screen-tsx-through-booking5screen-tsx-5-step-booking-flow-livestatusscreen-tsx-reservationsscreen-tsx-alertesscreen-tsx-clientprofilscreen-tsx-all-screens-use-go-from-useappstate-for-navigation-booking-confirmation-must-call-createbookingurl-from-lib-payrexx-ts-and-redirect-via-window-location-href-to-the-payrexx-twint-gateway-no-settimeout-fake-payment-flows",
      "title": "Deliver all client screens: `ExplorerScreen.tsx`, `FicheProScreen.tsx`, `Booking1Screen.tsx` through `Booking5Screen.tsx` (5-step booking flow), `LiveStatusScreen.tsx`, `ReservationsScreen.tsx`, `AlertesScreen.tsx`, `ClientProfilScreen.tsx`. All screens use `go()` from `useAppState` for navigation. Booking confirmation must call `createBookingUrl` from `lib/payrexx.ts` and redirect via `window.location.href` to the Payrexx TWINT gateway. No setTimeout fake payment flows.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-deliver-all-pro-screens-prodashboardscreen-tsx-proradarscreen-tsx-prowalletscreen-tsx-probusinessscreen-tsx-5-tabs-profile-services-tarifs-payment-gallery-subscriptionmodal-tsx-calls-createsubscriptionurl-from-lib-payrexx-ts-redirects-to-payrexx-twint-successscreen-tsx-no-stripe-no-emoji",
      "title": "Deliver all pro screens: `ProDashboardScreen.tsx`, `ProRadarScreen.tsx`, `ProWalletScreen.tsx`, `ProBusinessScreen.tsx` (5 tabs: profile, services, tarifs, payment, gallery), `SubscriptionModal.tsx` (calls `createSubscriptionUrl` from `lib/payrexx.ts`, redirects to Payrexx TWINT), `SuccessScreen.tsx`. No Stripe, no emoji.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-deliver-all-admin-screens-adminloginscreen-tsx-admindashboardscreen-tsx-adminprosscreen-tsx-adminbookingsscreen-tsx-adminrevenusscreen-tsx-admin-login-must-use-credentials-stored-in-localstorage-set-during-first-run-setupscreen-no-emoji",
      "title": "Deliver all admin screens: `AdminLoginScreen.tsx`, `AdminDashboardScreen.tsx`, `AdminProsScreen.tsx`, `AdminBookingsScreen.tsx`, `AdminRevenusScreen.tsx`. Admin login must use credentials stored in localStorage (set during first-run SetupScreen). No emoji.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-setupscreen-first-run-configuration-screen-display-it-before-adminloginscreen-if-any-of-vite-payrexx-instance-vite-payrexx-secret-or-vite-worker-url-are-empty-or-if-no-admin-credentials-exist-in-localstorage-the-screen-must-have-title-nexus-initial-configuration-inter-800-28px-payrexx-section-instance-input-placeholder-nexus-secret-api-input-type-password-twilio-section-worker-url-input-placeholder-https-admin-section-email-password-confirm-password-initialize-nexus-cta-button-with-gold-background-and-050507-text-saves-all-values-to-localstorage-and-to-the-canister-admin-config-via-lib-api-ts",
      "title": "Implement `SetupScreen` (first-run configuration screen). Display it before `AdminLoginScreen` if any of `VITE_PAYREXX_INSTANCE`, `VITE_PAYREXX_SECRET`, or `VITE_WORKER_URL` are empty OR if no admin credentials exist in localStorage. The screen must have: title 'NEXUS Initial Configuration' (Inter 800 28px), Payrexx section (Instance input placeholder 'nexus', Secret API input type=password), Twilio section (Worker URL input placeholder 'https://...'), Admin section (email, password, confirm password). 'Initialize NEXUS' CTA button with gold background and `#050507` text saves all values to localStorage and to the canister admin config via `lib/api.ts`.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Auth screens: LoginScreen (Internet Identity), RoleScreen (client/pro/admin), OTPScreen (6-digit SMS via Cloudflare Worker)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Client screens: Explorer, FichePro, Booking flow 5 steps, LiveStatus, Reservations, Alertes, ClientProfil",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Pro screens: ProDashboard, ProRadar, ProWallet, ProBusiness (5 tabs: profil/services/tarifs/paiement/galerie), SubscriptionModal, SuccessScreen",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Admin screens: AdminLogin, AdminDashboard, AdminPros, AdminBookings, AdminRevenus + SetupScreen (first-run config)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "SVG icon system (src/components/icons/index.tsx) replacing all emojis — 30+ icons with stroke currentColor",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "UI component library: BtnPrimary, BtnSecondary, Input, Label, Card, Toast, Header, TabBarClient, TabBarPro, TabBarAdmin, BottomSheet, ProgressCircle, Shimmer",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "lib/payrexx.ts: createSubscriptionUrl + createBookingUrl via Payrexx TWINT API (frontend fetch, credentials from env)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "lib/twilio.ts: sendOTP + verifyOTP via Cloudflare Worker (VITE_WORKER_URL)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Motoko backend (main.mo + Types.mo): full canister with auth, pro profile, services, explorer, bookings, wallet, notifications, avis, admin functions + heartbeat escrow 48h",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Global state (useAppState.ts), globals.css (CSS vars palette + animations + mobile reset), dfx.json ICP mainnet config, .env.production template",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Add documented Payrexx HTTP outcall stub in `backend/main.mo` as a block comment titled `PAYREXX_INTEGRATION`, showing the full commented-out `callPayrexx` function using `IC.http_request` for future ICP mainnet HTTP outcalls activation. The stub must be preserved verbatim and never deleted.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Deliver all UI component files under `src/components/ui/`: `BtnPrimary.tsx`, `BtnSecondary.tsx`, `Input.tsx`, `Label.tsx`, `Card.tsx`, `Toast.tsx`, `Header.tsx`, `TabBarClient.tsx`, `TabBarPro.tsx`, `TabBarAdmin.tsx`, `BottomSheet.tsx`, `ProgressCircle.tsx`, `Shimmer.tsx`. Each component must be fully functional with proper TypeScript props, onClick/onChange handlers, and no emojis.",
      "reqIds": [
        "REQ-5"
      ],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Create `backend/main.mo` (full Motoko actor) and `backend/Types.mo` implementing: user auth (Internet Identity principal), pro profiles (status, location, category, services, gallery, avis), explorer query (active pros + flash pros), 5-step booking lifecycle (pending → confirmed → in_progress → completed → cancelled), wallet (CHF balance, transfer with 30s cooldown), notifications, admin functions (validate pro, list all bookings, revenue stats), 48h escrow heartbeat, and admin config storage (SetupScreen values). Include the commented-out `PAYREXX_INTEGRATION` stub as specified.",
      "reqIds": [
        "REQ-11"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Create `.env.production` file at the project root with the template: `VITE_PAYREXX_INSTANCE=nexus`, `VITE_PAYREXX_SECRET=your_secret`, `VITE_WORKER_URL=https://nexus-sms.workers.dev`, `VITE_ICP_CANISTER_ID=your_canister_id`, `VITE_ICP_HOST=https://ic0.app`. Placeholder values must be clearly marked as requiring replacement.",
      "reqIds": [
        "REQ-12"
      ],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Enforce absolute layout rules across ALL screens: `flex flex-col fixed inset-0` on root container, scrollable content zone uses `flex-1 overflow-y-auto`, CTA buttons use `flex-shrink-0` anchored at bottom, tab bars use `flex-shrink-0` (never `position: fixed`). Remove all `100vh` CSS. Font is Inter exclusively. Palette CSS variables defined in `globals.css`. Gold background always pairs with `color: #050507`. Zero emojis anywhere in source code.",
      "reqIds": [
        "REQ-13"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "NEXUS",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}